## Tabla de Consultas SPL para Investigar Ataque de Fuerza Bruta
| **Consulta**                                                                 | **Propósito**                                                                 |
|------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| stats count by src_ip" | Identifica IPs de origen que realizan intentos de fuerza bruta mediante solicitudes POST con datos de usuario y contraseña. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| table _time src_ip form_data" | Muestra detalles de intentos de fuerza bruta, incluyendo tiempo, IP de origen y datos del formulario. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| rex field=form_data \"passwd=(?<userpassword>\w+)\" \| stats count by userpassword" | Extrae y cuenta las contraseñas usadas en el ataque para identificar patrones. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| rex field=form_data \"passwd=(?<userpassword>\w+)\" \| eval lenpword=len(userpassword) \| stats avg(lenpword) AS avgPword \| eval avgPword=round(avgPword,0)" | Calcula la longitud promedio de las contraseñas utilizadas en el ataque. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| timechart span=1s count by src_ip" | Visualiza la frecuencia de los intentos de fuerza bruta por IP en un gráfico temporal. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| rex field=form_data \"passwd=(?<userpassword>\w+)\" \| search userpassword=batman \| transaction userpassword \| table duration" | Calcula el tiempo entre el primer y segundo uso de la contraseña "batman". |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| iplocation src_ip \| geostats latfield=lat longfield=lon count by src_ip" | Mapea geográficamente las IPs de origen de los intentos de fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| stats count by src_ip \| where count > 100 \| table src_ip count" | Detecta IPs con alto volumen de intentos (>100), indicando actividad automatizada. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| rex field=form_data \"user=(?<username>\w+)\" \| stats count by username" | Identifica los nombres de usuario objetivo en los intentos de fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| stats earliest(_time) as first_attempt latest(_time) as last_attempt by src_ip \| eval duration=last_attempt-first_attempt \| table src_ip first_attempt last_attempt duration" | Calcula la duración total de los intentos de fuerza bruta por IP de origen. |

## Tabla de Consultas SPL para Detectar Actividad de Procesos Sospechosos Post-Fuerza Bruta
| **Consulta**                                                                 | **Propósito**                                                                 |
|------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 process=*cmd.exe \| table _time ProcessName CommandLine" | Lista procesos iniciados desde cmd.exe, común tras un acceso exitoso por fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*.exe \| eval len=len(CommandLine) \| table _time CommandLine len \| sort -len" | Identifica comandos largos ejecutados (sospechosos) tras el ataque, ordenados por longitud. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=11 *.exe *.zip \| table _time FileName ProcessName" | Detecta archivos .exe o .zip creados, posiblemente descargados tras un acceso exitoso. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 process=*powershell.exe \| table _time CommandLine ProcessName" | Busca comandos PowerShell ejecutados, comunes en ataques post-explotación. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*net.exe* \| table _time CommandLine ProcessName" | Detecta uso de net.exe (e.g., creación de usuarios), indicativo de escalamiento de privilegios. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=11 FileName=*.ps1 \| table _time FileName ProcessName" | Detecta creación de scripts PowerShell (.ps1), posibles indicadores de actividad maliciosa. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*whoami* \| table _time CommandLine ProcessName" | Busca ejecución de whoami, común en reconocimiento tras un acceso por fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*wget* OR CommandLine=*curl* \| table _time CommandLine ProcessName" | Identifica descargas de archivos usando wget o curl tras un acceso exitoso. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 ParentImage=*cmd.exe* CommandLine=*.exe \| table _time CommandLine ProcessName ParentImage" | Detecta procesos .exe iniciados desde cmd.exe, indicativos de ejecución de payloads. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*tasklist* OR CommandLine=*systeminfo* \| table _time CommandLine ProcessName" | Busca comandos de reconocimiento (tasklist, systeminfo) tras un acceso por fuerza bruta. |

## Tabla de Consultas SPL para Investigar Conexiones de Red y Artefactos Relacionados
| **Consulta**                                                                 | **Propósito**                                                                 |
|------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=3 dest_ip=192.168.250.70 \| stats count by src_ip dest_port" | Identifica conexiones de red hacia 192.168.250.70, agrupadas por IP de origen y puerto. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=3 dest_ip!=192.168.250.70 src_ip=192.168.250.70 \| table _time dest_ip dest_port" | Detecta conexiones salientes desde 192.168.250.70, posible comunicación con C2. |
| "index=\"botsv1\" sourcetype=\"stream:dns\" query{}=\"*.com\" OR query{}=\"*.net\" \| stats count by query{} src_ip" | Busca consultas DNS sospechosas desde 192.168.250.70, posible comunicación con dominios maliciosos. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=3 dest_port=80 OR dest_port=443 \| stats count by dest_ip dest_port" | Identifica conexiones a puertos HTTP/HTTPS, comunes en comunicación post-fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=11 FileName=*.dll \| table _time FileName ProcessName" | Detecta creación de archivos .dll, posibles indicadores de inyección de código. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=3 dest_ip!=192.168.250.* \| stats count by dest_ip" | Identifica conexiones a IPs externas, posibles para exfiltración o comunicación C2. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=GET \| table _time src_ip uri" | Detecta solicitudes GET sospechosas al host, posibles intentos de explotación adicionales. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*schtasks* \| table _time CommandLine ProcessName" | Busca creación de tareas programadas, comunes en persistencia tras fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"stream:tcp\" dest_ip=192.168.250.70 \| stats count by src_ip dest_port" | Analiza tráfico TCP hacia 192.168.250.70 para detectar patrones de ataque. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=7 ImageLoaded=* \| table _time ImageLoaded ProcessName" | Detecta módulos cargados dinámicamente (e.g., DLLs), posibles indicadores de malware. |

## Tabla de Consultas SPL Adicionales para Análisis Avanzado de Fuerza Bruta
| **Consulta**                                                                 | **Propósito**                                                                 |
|------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| rex field=form_data \"user=(?<username>\w+)\" \| stats count by username src_ip" | Identifica los nombres de usuario más atacados por cada IP de origen, útil para detectar objetivos específicos. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* status=200 \| table _time src_ip form_data" | Detecta intentos de fuerza bruta con respuesta HTTP 200, posibles inicios de sesión exitosos. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| stats count by src_ip status \| table src_ip status count" | Analiza códigos de respuesta HTTP por IP para identificar patrones de éxito o fallo en el ataque. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*reg.exe* \| table _time CommandLine ProcessName" | Detecta modificaciones al registro (e.g., reg.exe), posibles para persistencia tras un acceso exitoso. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=3 src_ip=192.168.250.70 dest_ip=192.168.250.* \| stats count by dest_ip dest_port" | Identifica conexiones internas desde 192.168.250.70, posibles intentos de movimiento lateral. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| stats dc(src_ip) as unique_ips count" | Calcula el número de IPs únicas y el total de intentos, útil para evaluar la escala del ataque. |
| "index=\"botsv1\" sourcetype=\"stream:tcp\" dest_ip=192.168.250.70 dest_port!=80 dest_port!=443 \| stats count by src_ip dest_port" | Detecta tráfico TCP no HTTP/HTTPS hacia 192.168.250.70, posible exploración de otros servicios. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=1 CommandLine=*netstat* \| table _time CommandLine ProcessName" | Busca ejecución de netstat, común en reconocimiento de red tras un acceso por fuerza bruta. |
| "index=\"botsv1\" sourcetype=\"stream:http\" dest_ip=192.168.250.70 http_method=POST form_data=*user*pass* \| timechart span=1m count by http_user_agent" | Visualiza los agentes de usuario usados en el ataque, útil para detectar herramientas automatizadas. |
| "index=\"botsv1\" sourcetype=\"xmlwineventlog:microsoft-windows-sysmon/operational\" EventCode=13 RegistryValueSet \| table _time TargetObject ProcessName" | Detecta cambios en valores del registro, posibles indicadores de persistencia post-fuerza bruta. |
